// Copyright 2020 - Daan de Lange
#define g using
g C=int;C f=10;g A=ImVec2;g B=float;bool E=1;B G;B U=IM_PI*2;B H=0;B R(A S){C X=S.x+S.y*57;X=(X<<13)^X;return .5+.5*(1.-((X*((X*X*15731)+789221)+1376312589)&0x7fffffff)/1073741824.);}B V(B Y,B Z,B X){B W=ImClamp<B>((X-Y)/(Z-Y),0,1);return W*W*(3-2*W);}C I(A S){return C(ImMin<C>(S.x,320-1)/f)+C(ImMin<C>(S.y,180-1)/f)*(320/f);}A K[50];B Q[576];void FX(ImDrawList*F,A D,A,A b,ImVec4,B T){B J=0;if(E)G=(H+1337e-8*(intptr_t)&E);for(C M=0;M<576;++M){A c=A(fmodf(M,320/f),M/(320/f));if(E){B X=R(ImFloor(c)+A(G*f,0));Q[M]=(X<.5?1:(X>.7?0:2))+(H>T-1)*1-fmodf(T+M,2.1);}C d,e=d=0;if(Q[M]<=1){e=255-20*V(-1,0,fmodf(Q[M],1));d=e*V(1,0,Q[M]);}A S=D+c*f;F->AddRectFilled(S,S+A(f,10),IM_COL32(d,e,d,255));J+=Q[M]*(Q[M]>0&&Q[M]<=1);}for(C L=0;L<50;++L){if(E)K[L]=A(R(A(T,L)),R(A(L,T)))*b;A S=K[L];B O=(R(ImFloor(S/f)*f+A(L,L))+(C(T*.17))+T*.27*(L%2?1:-1))*U;C a=I(S);B&N=Q[a];N-=.2*(N<=1);A P(cos(O),sin(O));K[L]=ImClamp(K[L]+P*(Q[I(S+P*4)]<=1),A(0,0),b);F->AddCircleFilled(D+S,4,0xFF003acc);}if(H<T-1){E=J<1;if(E)H=T;}}